-- 1. Изведете ИД-тата на отделите и по колко служителя има във всеки един от тях
select departmentid, count(1) CountOfEmployees
from employees
group by departmentid;
-- 2. Изведете ИД-тата на отделите, в които има повече от 2-ма служителя
select departmentid
from employees
group by departmentid
having count(1) > 2;

-- 3. Изведете бройката на служителите, които са ползвали отпуск през 2010-та (поне два начина)
select count(distinct employeeid) from vacations
where
year(fromdate) = 2010
or year(todate) = 2010;
 

-- 4. Изведете всички позиции/тайтъли, които съдържат думата Junior
select *
from titles 
where name like '%Junior%'

-- 5. Изведете всички позиции/тайтъли, които започват с думата Junior
select *
from titles 
where name like 'Junior%'


-- 6. Изведете всички позиции/тайтъли, които съдържат думата Junior, но не завършват на нея.
select *
from titles 
where name like '%Junior_%'

select *
from titles 
where name like '%Junior%'
and not like '%Junior'



-- 7. Изведете бройката на служителите, наети през последните 5 години, 3 месеца и 2 дни. (поне два начина)
select *
from employees 
where hiredate > ADDDATE(ADDDATE(ADDDATE(now(), INTERVAL -5 YEAR), INTERVAL -3 MONTH), INTERVAL -2 DAY);

select *
from employees 
where year(hiredate) > year(now()) -5
or(year(hiredate) = year(now()) -5 and month(hiredate) > month(now()) - 3) 
or(year(hiredate) = year(now()) -5 and month(hiredate) = month(now()) -3 and day(hiredate) >= day(now()) - 2)


-- 8. Изведете бройката на наетите служители по години и месеци
select concat(year(hiredate),'-',month(hiredate)), count(1)
from employees 
group by concat(year(hiredate),'-',month(hiredate))
order by year(hiredate),month(hiredate);


-- 9. Изведете име на служител и колона, в която да има стойности '1-3','3-5','5-10','10+' в зависимост от това дадения служител от колко години е във фирмата.
select name, 
case 
	when (datediff(now(),hiredate)*1.000)/365 >= 1 and (datediff(now(),hiredate)*1.000)/365 < 3 then '1-3'
	when (datediff(now(),hiredate)*1.000)/365 >= 3 and (datediff(now(),hiredate)*1.000)/365 < 5 then '3-5'
	when (datediff(now(),hiredate)*1.000)/365 >= 5 and (datediff(now(),hiredate)*1.000)/365 < 10 then '5-10'
	when (datediff(now(),hiredate)*1.000)/365 >= 10 then '10+'
	else 'N/A'
end 	
from employees;


-- 10. Изведете 2 колони - колона, в която да има стойности '1-3','3-5','5-10','10+' в зависимост от това даденият служител от колко години е във фирмата и колона, в която имаме брой служители попадащи в съответната категория.
select 
case 
	when (datediff(now(),hiredate)*1.000)/365 >= 1 and (datediff(now(),hiredate)*1.000)/365 < 3 then '1-3'
	when (datediff(now(),hiredate)*1.000)/365 >= 3 and (datediff(now(),hiredate)*1.000)/365 < 5 then '3-5'
	when (datediff(now(),hiredate)*1.000)/365 >= 5 and (datediff(now(),hiredate)*1.000)/365 < 10 then '5-10'
	when (datediff(now(),hiredate)*1.000)/365 >= 10 then '10+'
	else 'N/A'
end ,
count(1)	
from employees
group by 
case 
	when (datediff(now(),hiredate)*1.000)/365 >= 1 and (datediff(now(),hiredate)*1.000)/365 < 3 then '1-3'
	when (datediff(now(),hiredate)*1.000)/365 >= 3 and (datediff(now(),hiredate)*1.000)/365 < 5 then '3-5'
	when (datediff(now(),hiredate)*1.000)/365 >= 5 and (datediff(now(),hiredate)*1.000)/365 < 10 then '5-10'
	when (datediff(now(),hiredate)*1.000)/365 >= 10 then '10+'
	else 'N/A'
end

 
-- 11. Изведете датата на раждане на човек с ЕГН '8508066060'.


SELECT cast(concat('19',SUBSTR('8508066060', 1,2),'-',SUBSTR('8508066060', 3,2),'-',SUBSTR('8508066060', 5,2)) as date);


-- 12. Изведете първо число на текущ месец/година

SELECT MAKEDATE( year(now()),1);

select DATE_FORMAT(NOW() ,'%Y-%m-01') ;

-- 13. Изведете последното число на текущ месец

SELECT LAST_DAY(now());

-- 14. Изведете 3-те месеца, в които са се наемали най-много служители.
select month(hiredate), count(1)
from employees 
group by month(hiredate)
order by 2 desc
limit 3

-- 15. Намерете кога за последно е наеман служител през 2010-та
select max(hiredate)
from employees
where hiredate >= '2010-01-01'
and hiredate< '2011-01-01'


/* задачите от презентацията */

-- 16. Изведете средната/максималната/минималната заплата на служителите
select max(salary) from employees


-- 17. Изведете средната/максималната/минималната заплата на служителите от отдел с ИД=5
select min(salary) 
from employees
where departmentid = 5

-- 18. Изведете бройката на служителите
select count(*) from employees;

select count(1) from employees;

select count(id) from employees;

 
-- 19. Изведете бройката на служителите с мениджър (поне по два начина) 
select count(1)
from employees
where ManagerId is not null;

select count(ManagerId)
from employees;


 
-- 20. Изведете бройката на мениджърите 
select count(distinct ManagerId)
from employees ;


-- 21. Изведете бройката на служителите, работещи в отдел/департмънт, за които средната заплата е по-голяма от 2000
 
select departmentid , count(id)
from employees
group by departmentid
having avg(salary) > 2000